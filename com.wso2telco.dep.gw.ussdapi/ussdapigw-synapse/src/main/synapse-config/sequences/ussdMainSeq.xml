<?xml version="1.0" encoding="UTF-8"?>
<sequence name="ussdMainSeq" trace="disable" xmlns="http://ws.apache.org/ns/synapse">
    <sequence key="apiPropertySeq"/>

    <call-template target="com.wso2telco.dep.common.loggingExtension.Template">
        <with-param name="direction" value="REQUESTIN"/>
    </call-template>

    <class name="com.wso2telco.dep.mediator.HandlerMediator">
        <property name="executorClass" value="com.wso2telco.dep.mediator.impl.ussd.USSDExecutor"/>
    </class>
    <filter xpath="boolean($ctx:MSISDN)">
        <then>
            <!-- validate the msisdn for black list and white list -->
            <call-template target="com.wso2telco.dep.common.blacklistWhitelistValidator.Template">
                <with-param name="paramName" value="address"/>
                <with-param name="paramValue" value="{$ctx:MSISDN}"/>
            </call-template>
        </then>
        <else/>
    </filter>
    <switch source="get-property('HANDLER')">
        <case regex="SendUSSDHandler">
            <sequence key="sendUssdSeq"/>
        </case>
        <case regex="USSDInboundHandler">
            <sequence key="ussdInboundSeq"/>
        </case>
        <case regex="SouthBoundMOUSSDSubscribeHandler">
            <sequence key="ussdMOSubscribeSeq"/>
        </case>
        <case regex="SouthBoundStopMOUSSDSubscriptionHandler">
            <sequence key="ussdMOStopSubscriptionSeq"/>
        </case>
        <default>
            <!-- TODO:handle error -->
        </default>
    </switch>
</sequence>